function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}function _defineProperty(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function styleInject(e,n){void 0===n&&(n={});var t,r=n.insertAt;e&&"undefined"!=typeof document&&(t=document.head||document.getElementsByTagName("head")[0],(n=document.createElement("style")).type="text/css","top"===r&&t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)))}var css_248z=".wrap__code {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: fixed;\r\n  visibility: hidden;\r\n}\r\n\r\n.wrap__code.active {\r\n  visibility: visible;\r\n}\r\n.wrap-box {\r\n  width: 260px;\r\n  background-color: #f1f1f1;\r\n  padding: 20px;\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  box-sizing: border-box;\r\n}\r\n\r\n.warp-box-image {\r\n  width: 220px;\r\n  height: 110px;\r\n  display: inline-block;\r\n  cursor: pointer;\r\n}\r\n\r\n.warp-box-text {\r\n  color: #333;\r\n  font-size: 16px;\r\n  font-weight: bold;\r\n  line-height: 40px;\r\n  height: 40px;\r\n  display: inline-block;\r\n}\r\n\r\n.warp-box-btns {\r\n  width: 100%;\r\n  display: flex;\r\n  justify-content: space-around;\r\n  align-items: center;\r\n}\r\n\r\n.warp-btn {\r\n  width: 100px;\r\n  background-color: #ef8200;\r\n  color: #fff;\r\n  line-height: 40px;\r\n  text-align: center;\r\n  display: inline-block;\r\n  cursor: pointer;\r\n}\r\n\r\n.warp-btn-ok {\r\n\r\n}\r\n\r\n.warp-btn-cancel {\r\n\r\n}\r\n\r\n.warp-flag {\r\n  display: block;\r\n  position: absolute;\r\n  background-color: skyblue;\r\n  width: 15px;\r\n  height: 15px;\r\n  border-radius: 50%;\r\n  position: fixed;\r\n  color: white;\r\n  font-size: 12px;\r\n  text-align: center;\r\n  line-height: 15px;\r\n  z-index: 999999;\r\n  cursor: pointer;\r\n}";styleInject(css_248z);var BnqVerificationCode=function(){function t(e){var c=this,n=e.onOk,e=e.onCancel;_classCallCheck(this,t),_defineProperty(this,"createDOM",function(){var e=document.createElement("div");e.className="wrap__code";e.innerHTML='\n      <div class=\'wrap-box\'>\n        <img class="warp-box-image" />\n        <span class="warp-flags"></span>\n        <span class="warp-box-text"></span>\n        <div class="warp-box-btns" >\n          <span class="warp-btn warp-btn-ok">确定</span>\n          <span class="warp-btn warp-btn-cancel">取消</span>\n        </div>\n      </div>\n    ',document.body.appendChild(e);var n=document.querySelector(".warp-box-image"),t=document.querySelector(".warp-btn-ok"),e=document.querySelector(".warp-btn-cancel");n.addEventListener("click",c.clickImage),t.addEventListener("click",c.handlerOk),e.addEventListener("click",c.closeWarp)}),_defineProperty(this,"clickImage",function(e){var n,t,r,o,a;9<c.picCode.length||(n=e.clientX,t=e.clientY,a=n-(r=e.target.getBoundingClientRect().left),e=t-(o=e.target.getBoundingClientRect().top),c.addFlag(n-r+14,t-o+8),c.picCode=c.picCode.concat([[a,e]]))}),_defineProperty(this,"addFlag",function(e,n){var t=document.createElement("span");t.className="warp-flag",t.style.left="".concat(e,"px"),t.style.top="".concat(n,"px");n=document.createTextNode(c.picCode.length+1);t.appendChild(n),document.querySelector(".warp-flags").appendChild(t)}),_defineProperty(this,"handlerOk",function(){var e={mobile:c.mobile,clientType:3,height:110,width:220,picCode:encodeURI(base64encode(JSON.stringify(c.picCode)))};c.requestFunc("https://pt.bthome.com/pcApi/apis/auth/v2/getSmsCode.do","GET",e,c.callbackOk)}),_defineProperty(this,"callbackOk",function(e){e.success?c.onOk&&c.onOk():c.onCancel&&c.onCancel(),c.closeWarp()}),_defineProperty(this,"closeWarp",function(){c.picCode=[],c.mobile=void 0,document.querySelector(".warp-flags").innerHTML="",document.querySelector(".wrap__code").classList.remove("active")}),_defineProperty(this,"openWarp",function(e){c.mobile=e,document.querySelector(".wrap__code").classList.add("active"),c.requestFunc("https://pt.bthome.com/pcApi/apis/auth/v2/getImgCode.jpg","GET",{mobile:e},c.setImage)}),_defineProperty(this,"requestFunc",function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"GET",t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length?arguments[3]:void 0;n+="?",Object.keys(t).forEach(function(e){n+="".concat(e,"=").concat(t[e],"&")});var o=new XMLHttpRequest;o.open(e,n),o.send(),o.onreadystatechange=function(){4===o.readyState&&200===o.status&&r(JSON.parse(o.response))}}),_defineProperty(this,"createScript",function(n){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=2<arguments.length?arguments[2]:void 0;n+="?",Object.keys(t).forEach(function(e){n+="".concat(e,"=").concat(t[e],"&")}),n+="callback=".concat(e);e=document.createElement("script");e.src=n,document.body.appendChild(e),document.body.removeChild(e)}),_defineProperty(this,"setImage",function(e){var n,t=e.data;0===e.code&&(n=document.querySelector(".warp-box-image"),e=document.querySelector(".warp-box-text"),n.src=t.image,e.innerHTML=t.code)}),this.picCode=[],this.mobile=void 0,this.onOk=n,this.onCancel=e}return _createClass(t,[{key:"init",value:function(){this.createDOM()}}]),t}(),base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function base64encode(e){for(var n,t,r,o=e.length,a=0,c="";a<o;){if(n=255&e.charCodeAt(a++),a==o){c+=base64EncodeChars.charAt(n>>2),c+=base64EncodeChars.charAt((3&n)<<4),c+="==";break}if(t=e.charCodeAt(a++),a==o){c+=base64EncodeChars.charAt(n>>2),c+=base64EncodeChars.charAt((3&n)<<4|(240&t)>>4),c+=base64EncodeChars.charAt((15&t)<<2),c+="=";break}r=e.charCodeAt(a++),c+=base64EncodeChars.charAt(n>>2),c+=base64EncodeChars.charAt((3&n)<<4|(240&t)>>4),c+=base64EncodeChars.charAt((15&t)<<2|(192&r)>>6),c+=base64EncodeChars.charAt(63&r)}return c}function picCode(e){e=new BnqVerificationCode(e);return e.init(),e}module.exports=picCode;
